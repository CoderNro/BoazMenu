name: Build DMT139z Dylib

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest  # âœ… OK, dÃ¹ng macOS má»›i nháº¥t
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4  # âœ… NÃ¢ng tá»« v3 lÃªn v4
      
    - name: Setup Theos
      run: |
        sudo mkdir -p /opt/theos
        sudo git clone --recursive https://github.com/theos/theos.git /opt/theos
        echo "THEOS=/opt/theos" >> $GITHUB_ENV
        echo "PATH=/opt/theos/bin:$PATH" >> $GITHUB_ENV  # âœ… ThÃªm PATH
        
    - name: Install dependencies
      run: |
        brew install ldid xz
        # âŒ Bá» dÃ²ng nicify vÃ¬ nÃ³ khÃ´ng cáº§n thiáº¿t
        
    - name: Verify files
      run: |
        ls -la
        # Kiá»ƒm tra xem cÃ³ Makefile khÃ´ng
        test -f Makefile || echo "âš ï¸ KhÃ´ng tÃ¬m tháº¥y Makefile"
        
    - name: Build dylib
      run: |
        make clean
        make
        # make package  # âŒ Táº¡m thá»i comment náº¿u chÆ°a cÃ³ cáº¥u hÃ¬nh package
        
    - name: Find dylib files
      run: |
        echo "ğŸ” TÃ¬m kiáº¿m file .dylib..."
        find . -name "*.dylib" -type f
        find . -name "*.deb" -type f
        
    - name: Upload artifacts
      uses: actions/upload-artifact@v4  # âœ… NÃ¢ng tá»« v3 lÃªn v4
      with:
        name: DMT139z-Build
        path: |
          **/*.dylib
          **/*.deb
          **/*.plist
        retention-days: 30
        if-no-files-found: warn  # âœ… Cáº£nh bÃ¡o náº¿u khÃ´ng tÃ¬m tháº¥y file
